---
phase: "1.4"
plan: "01"
subsystem: "app/application, managers/ui_manager"
tags: [refactoring, god-class, ui-manager, extraction]
dependency-graph:
  requires: ["1.1-EventBus", "1.2-ConnectionPool", "1.3-MainThreadQueue"]
  provides: ["UIManager class", "managers/ directory"]
  affects: ["Application.h", "Application.cpp", "CMakeLists.txt"]
tech-stack:
  added: []
  patterns: ["manager delegation", "callback injection"]
key-files:
  created:
    - "src/managers/ui_manager.h"
    - "src/managers/ui_manager.cpp"
  modified:
    - "src/app/application.h"
    - "src/app/application.cpp"
    - "src/CMakeLists.txt"
decisions:
  - "UIManager owns all panels, dialogs, visibility, menu bar, shortcuts, dock layout"
  - "StartPage callbacks wired by Application, not UIManager (per Plan 02 dependency)"
  - "ConfigWatcher stays in Application until Plan 03"
  - "Old src/ui/ui_manager.cpp excluded from build (name collision), header preserved for Phase 1.6"
  - "Action callbacks injected from Application into UIManager via setOn* methods"
metrics:
  duration: "5m 32s"
  completed: "2026-02-09"
  tasks: 1
  files-changed: 5
  files-created: 2
---

# Phase 1.4 Plan 01: Extract UIManager from Application Summary

**One-liner:** Extracted all UI panel ownership, visibility state, menu bar, keyboard shortcuts, dialogs, import progress overlay, about/restart popups, and dock layout from Application into a new UIManager class in src/managers/.

## What Was Done

### Task: Extract UIManager from Application God Class

Created `src/managers/ui_manager.h` (153 lines) and `src/managers/ui_manager.cpp` (403 lines) containing:

- **Panel ownership**: ViewportPanel, LibraryPanel, PropertiesPanel, ProjectPanel, GCodePanel, CutOptimizerPanel, StartPage
- **Dialog ownership**: FileDialog, LightingDialog
- **Visibility state**: 7 boolean flags (showViewport, showLibrary, etc.)
- **Menu bar**: Full File/View/Edit/Help menu with action callback delegation
- **Keyboard shortcuts**: Ctrl+N/O/S/I/E/Comma/L with callback delegation
- **Import progress overlay**: Bottom-right progress bar with cancel button
- **About dialog**: Modal popup with version and library info
- **Restart popup**: UI scale change notification with relaunch option
- **Dock layout**: Default layout setup (left sidebar, center viewport, right properties)
- **Config helpers**: restoreVisibilityFromConfig(), saveVisibilityToConfig(), applyRenderSettingsFromConfig()

Updated Application to delegate all UI operations through `m_uiManager`:
- Application.cpp reduced from 1,108 lines to 803 lines (28% reduction)
- Application.h reduced from 150 lines to 118 lines (21% reduction)
- Removed 12 panel/dialog/visibility member variables from Application
- Removed 6 UI-specific method declarations (renderMenuBar, renderPanels, renderImportProgress, showAboutDialog, handleKeyboardShortcuts, setupDefaultDockLayout, renderRestartPopup)
- Business logic callbacks (onImportModel, onExportModel, onNewProject, etc.) stay in Application

### Wiring Pattern

Application injects action callbacks into UIManager via `setOn*` methods:
```cpp
m_uiManager->setOnNewProject([this]() { onNewProject(); });
m_uiManager->setOnImportModel([this]() { onImportModel(); });
// etc.
```

UIManager provides panel accessors so Application can wire inter-panel callbacks:
```cpp
m_uiManager->libraryPanel()->setOnModelSelected([this](int64_t id) { ... });
m_uiManager->propertiesPanel()->setOnMeshModified([this]() { ... });
```

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking] Resolved dw::UIManager symbol collision**
- **Found during:** Build phase
- **Issue:** Both `src/ui/ui_manager.cpp` (old, dead code) and `src/managers/ui_manager.cpp` (new) define `dw::UIManager` with overlapping method names, causing linker errors
- **Fix:** Removed `src/ui/ui_manager.cpp` from the CMakeLists.txt build list (commented out with note). Header `src/ui/ui_manager.h` preserved untouched per plan requirements (Phase 1.6 cleanup)
- **Files modified:** `src/CMakeLists.txt`
- **Commit:** e8b889f

## Verification

- Build: Clean compilation with no errors
- Tests: All 410 tests pass with zero regressions
- Line reduction: Application.cpp 1,108 -> 803 lines
- src/ui/ui_manager.h: NOT modified (confirmed untouched)
- ConfigWatcher: Still owned by Application (not moved)
- StartPage callbacks: Wired in Application::init(), not UIManager::init()

## Self-Check: PASSED

- [x] `src/managers/ui_manager.h` exists
- [x] `src/managers/ui_manager.cpp` exists
- [x] `src/app/application.h` modified (no panel members)
- [x] `src/app/application.cpp` modified (delegates through m_uiManager)
- [x] `src/CMakeLists.txt` modified (includes managers/ui_manager.cpp)
- [x] Commit e8b889f exists
- [x] All 410 tests pass
