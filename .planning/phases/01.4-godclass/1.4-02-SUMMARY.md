---
phase: "1.4"
plan: "02"
subsystem: "app/application, managers/file_io_manager"
tags: [refactoring, god-class, file-io-manager, extraction]
dependency-graph:
  requires: ["1.4-01-UIManager"]
  provides: ["FileIOManager class"]
  affects: ["Application.h", "Application.cpp", "CMakeLists.txt"]
tech-stack:
  added: []
  patterns: ["manager delegation", "callback injection", "setShowStartPage callback pattern"]
key-files:
  created:
    - "src/managers/file_io_manager.h"
    - "src/managers/file_io_manager.cpp"
  modified:
    - "src/app/application.h"
    - "src/app/application.cpp"
    - "src/CMakeLists.txt"
decisions:
  - "FileIOManager receives raw pointers via constructor injection, does NOT own subsystems"
  - "Panel pointers passed per-call to processCompletedImports, not stored as members"
  - "setShowStartPage callback pattern decouples FileIOManager from UIManager visibility state"
  - "StartPage callbacks wired in Application::init() after both UIManager and FileIOManager exist (Option B)"
  - "FileIOManager destroyed before UIManager in shutdown (FileIOManager holds raw pointer to FileDialog owned by UIManager)"
metrics:
  duration: "4m 52s"
  completed: "2026-02-09"
  tasks: 2
  files-changed: 5
  files-created: 2
---

# Phase 1.4 Plan 02: Extract FileIOManager from Application Summary

**One-liner:** Extracted all file I/O orchestration (import, export, project new/open/save, drag-and-drop, completed import processing, recent project opening) from Application into a focused FileIOManager class coordinating 8 subsystems via constructor-injected raw pointers.

## What Was Done

### Task 1: Create FileIOManager class

Created `src/managers/file_io_manager.h` (62 lines) and `src/managers/file_io_manager.cpp` (249 lines) containing:

- **importModel()**: Opens multi-select file dialog, enqueues selected paths to ImportQueue
- **exportModel()**: Gets focused mesh from Workspace, opens save dialog, exports via ModelExporter
- **onFilesDropped()**: Filters drag-and-drop paths by supported extensions, enqueues to ImportQueue
- **processCompletedImports()**: Polls ImportQueue for completed tasks, generates thumbnails via LibraryManager, refreshes LibraryPanel, sets mesh on ViewportPanel/PropertiesPanel
- **newProject()**: Creates project via ProjectManager, hides start page via callback
- **openProject()**: Opens file dialog, searches existing projects or creates new, updates Config recent projects
- **saveProject()**: Handles save-as dialog for new projects, direct save for existing
- **openRecentProject()**: Searches DB for existing project at path, creates new if not found

Constructor takes 8 raw pointers: EventBus, Database, LibraryManager, ProjectManager, ImportQueue, Workspace, FileDialog, ThumbnailGenerator.

**Commit:** 616d1fb

### Task 2: Integrate FileIOManager into Application

Updated Application to delegate all file I/O operations through `m_fileIOManager`:

- **application.h**: Added FileIOManager forward declaration and `m_fileIOManager` member. Removed 8 method declarations (onImportModel, onExportModel, onNewProject, onOpenProject, onSaveProject, onFilesDropped, processCompletedImports, onOpenRecentProject). Only onModelSelected retained as business logic.
- **application.cpp**: Created FileIOManager in init() after UIManager. Rewired StartPage callbacks through FileIOManager. Rewired UIManager action callbacks (menu bar/shortcuts) through FileIOManager. Updated processEvents() to delegate onFilesDropped. Updated update() to delegate processCompletedImports. Removed 8 method implementations. Added FileIOManager reset in shutdown() before UIManager.
- **CMakeLists.txt**: Added `managers/file_io_manager.cpp` to DW_SOURCES.
- Removed 7 unused includes from application.cpp (model_exporter, import_task, loader_factory, file_dialog, lighting_dialog, message_dialog, project).
- Application.cpp: 803 -> 613 lines (190-line reduction, 24%)

**Commit:** d9a8d87

### Wiring Pattern

Application creates both UIManager and FileIOManager, then wires callbacks:
```cpp
// FileIOManager constructed with raw pointer to UIManager's FileDialog
m_fileIOManager = std::make_unique<FileIOManager>(
    ..., m_uiManager->fileDialog(), ...);

// Callbacks pass setShowStartPage lambda to decouple from UIManager
m_uiManager->setOnNewProject([this]() {
    m_fileIOManager->newProject(
        [this](bool show) { m_uiManager->showStartPage() = show; });
});
```

## Deviations from Plan

None - plan executed exactly as written.

Note: Application.cpp ended at 613 lines rather than the plan's estimate of ~450-500 lines. The difference is because (a) the plan estimated the pre-extraction size at ~700-750 but it was actually 803 lines, and (b) the callback wiring lambdas in init() are inherently more verbose than the old direct method calls they replaced. All 8 file I/O methods were fully extracted as specified.

## Verification

- Build: Clean compilation with no errors, zero new warnings
- Tests: All 410 tests pass with zero regressions
- Line reduction: Application.cpp 803 -> 613 lines (-190 lines, cumulative -495 from original 1,108)
- FileIOManager.h: 62 lines (min 40 satisfied)
- FileIOManager.cpp: 249 lines (min 200 satisfied)
- No file I/O logic remains directly in Application (only delegation calls)
- Import, export, project operations all route through FileIOManager

## Self-Check: PASSED

- [x] `src/managers/file_io_manager.h` exists (62 lines)
- [x] `src/managers/file_io_manager.cpp` exists (249 lines)
- [x] `src/app/application.h` modified (no file I/O method declarations)
- [x] `src/app/application.cpp` modified (delegates through m_fileIOManager)
- [x] `src/CMakeLists.txt` modified (includes managers/file_io_manager.cpp)
- [x] Commit 616d1fb exists
- [x] Commit d9a8d87 exists
- [x] All 410 tests pass
