# Plan 16-02: Clearing Tool Recommendation and UI Presentation

**Phase**: 16 — Tool Recommendation
**Requirements**: DC-12, DC-13

## Overview

Add clearing tool recommendation for island regions and present all recommendations in a UI component that shows tool details, feeds/speeds, and reasoning.

## Modifications

### `src/core/carve/tool_recommender.cpp` — Add clearing tool scoring

**scoreClearingTool()** (~25 lines, new method in ToolRecommender):
- Only called when islands detected
- For each island, check tool diameter vs `island.minClearDiameter`:
  - Tool diameter must be <= island's narrowest passage
  - Prefer largest tool that fits (faster clearing)
- Check flute_length >= island depth
- Flat end mills preferred (endmill type = 1), then ball nose
- Score = coverage fraction (what % of islands this tool can clear)

Add to `recommend()`: after finishing tools, if `needsClearing`, score clearing candidates.

### `src/core/carve/tool_recommender.h` — Add clearing scorer declaration

```cpp
f32 scoreClearingTool(const VtdbToolGeometry& geom,
                      const RecommendationInput& input);
```

## New Files

### `src/ui/widgets/tool_recommendation_widget.h` (~60 lines)

```cpp
namespace dw {

// Renders tool recommendation results as an ImGui widget.
// Used by the Direct Carve wizard.
class ToolRecommendationWidget {
public:
    // Set data to display
    void setRecommendation(
        const carve::RecommendationResult& result);

    // Render the widget. Returns true if user selection changed.
    bool render();

    // Get user's selection
    const carve::ToolCandidate* selectedFinishing() const;
    const carve::ToolCandidate* selectedClearing() const;

private:
    carve::RecommendationResult m_result;
    int m_selectedFinishing = 0;
    int m_selectedClearing = 0;

    void renderToolCard(const carve::ToolCandidate& tool,
                        bool selected);
};

} // namespace dw
```

### `src/ui/widgets/tool_recommendation_widget.cpp` (~180 lines)

**render()**:
1. Section header: "Finishing Tool"
2. For each finishing candidate:
   - `renderToolCard()` — selectable card showing:
     - Tool name and type icon (V-bit / Ball Nose / TBN)
     - Diameter and included angle (if V-bit)
     - Tip radius (if ball nose / TBN)
     - Feed rate, spindle speed, stepover from cutting data
     - Reasoning text in dim color
   - Radio-button style selection (ImGui::Selectable)

3. If `needsClearing`:
   - Section header: "Clearing Tool (for island regions)"
   - Island summary: count, total area, max depth
   - Clearing tool cards same format

**renderToolCard()** (~40 lines):
- `ImGui::BeginGroup()` / `EndGroup()` for card layout
- Tool type as colored badge (V-bit=green, BallNose=blue, TBN=purple, EndMill=orange)
- Key specs in 2-column layout
- Feeds/speeds row: "F{feed} S{spindle} SO{stepover}%"
- Reasoning as italic text

### Tests

No UI tests (ImGui widget), but tool_recommender_test.cpp from 16-01 covers clearing logic:

Additional tests in `tool_recommender_test.cpp`:
- `TEST(ToolRecommender, ClearingToolFitsIsland)` — clearing tool diameter fits island
- `TEST(ToolRecommender, ClearingPrefersFlatEndMill)` — end mills score higher for clearing
- `TEST(ToolRecommender, NoClearingWhenNoIslands)` — clearing list empty without islands

## Coding Standards Compliance

- Widget file ~180 lines (within 800)
- renderToolCard helper keeps render() under 50 lines
- No hardcoded colors — use theme constants or calculate from tool type
- Selection state in widget, recommendation data from external source
