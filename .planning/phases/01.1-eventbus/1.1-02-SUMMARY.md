---
phase: 01.1-eventbus
plan: 02
subsystem: app
tags: [eventbus, application, lifecycle, integration]

# Dependency graph
requires:
  - phase: 1.1-01
    provides: EventBus implementation with type-safe pub/sub API
provides:
  - Application owns EventBus instance with correct lifecycle ordering
  - EventBus accessible to subsystems via eventBus() accessor
  - EventBus initialized before other systems, destroyed after subscribers
affects: [1.4-decomposition, import-pipeline, workspace-management]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - EventBus lifecycle management in Application init/shutdown
    - Forward declaration pattern for reduced header dependencies

key-files:
  created: []
  modified:
    - src/app/application.h
    - src/app/application.cpp

key-decisions:
  - "EventBus initialized before Database (EventBus has no dependencies)"
  - "EventBus destroyed after Database in shutdown (subscribers may hold tokens)"
  - "eventBus() accessor returns reference for subsystem wiring"

patterns-established:
  - "Core systems initialization order: EventBus -> Database -> Managers -> Panels"
  - "Shutdown order reverses initialization (panels -> managers -> database -> eventbus)"

# Metrics
duration: 1m 40s
completed: 2026-02-09
---

# Phase 1.1 Plan 02: Application EventBus Integration Summary

**EventBus integrated into Application lifecycle with correct initialization/shutdown ordering - zero behavioral changes, all 387 tests pass**

## Performance

- **Duration:** 1m 40s
- **Started:** 2026-02-09T04:59:39Z
- **Completed:** 2026-02-09T05:01:19Z
- **Tasks:** 1
- **Files modified:** 2

## Accomplishments
- EventBus member added to Application class
- EventBus initialized in init() before Database (line 161)
- EventBus destroyed in shutdown() after Database (line 1056)
- eventBus() accessor method added for subsystem access
- Forward declaration added to minimize header dependencies
- Full application compiles successfully
- All 387 tests pass with zero regressions

## Task Commits

Each task was committed atomically:

1. **Task 1: Add EventBus member to Application and wire lifecycle** - `07b2a03` (feat)
   - Added EventBus forward declaration in application.h
   - Added std::unique_ptr<EventBus> m_eventBus member (before Database)
   - Added eventBus() accessor method returning EventBus&
   - Included core/events/event_bus.h in application.cpp
   - Initialized EventBus in init() before Database construction
   - Destroyed EventBus in shutdown() after Database destruction
   - Verified full application compiles
   - Verified all 387 tests pass (including EventBus tests from Plan 01)

## Files Created/Modified
- `src/app/application.h` - Added EventBus forward declaration, member, and accessor (3 additions)
- `src/app/application.cpp` - Added include, initialization, and shutdown (3 additions)

## Decisions Made

1. **EventBus before Database in init()**: EventBus has no dependencies and should be available first as the foundational communication layer. Database and other systems may want to use EventBus during their initialization.

2. **EventBus after Database in shutdown()**: EventBus is destroyed last (after Database) because managers and panels that subscribe to events are destroyed before Database. Any remaining subscription tokens must remain valid until after Database cleanup.

3. **eventBus() accessor returns reference**: Subsystems will receive EventBus by reference during construction in Phase 1.4 (God Class Decomposition). Returning a reference prevents null pointer issues and makes the lifecycle contract explicit.

4. **Forward declaration pattern**: EventBus is forward-declared in application.h and only included in application.cpp. This minimizes header dependencies and speeds up compilation.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

**Minor clang-format violation**: Initial commit had two spaces before comment on line 1056. Fixed by removing extra space. This is a standard formatting compliance check, not a functional issue.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

Application now owns EventBus with correct lifecycle. Ready for Phase 1.4 (God Class Decomposition) where subsystems will be extracted and wired to EventBus.

**Ready for:**
- UIManager extraction with EventBus reference passed in constructor
- FileIOManager extraction with EventBus reference passed in constructor
- Replacing Application callback chains with event publish/subscribe

**Blockers:** None

**Dependencies satisfied:**
- Plan 1.1-01 (EventBus implementation) ✓
- Application lifecycle infrastructure ✓

## Self-Check: PASSED

Verified all claims in summary:
- Both modified files exist at specified paths
- Commit hash 07b2a03 exists in git log
- EventBus member declared at line 103 of application.h
- EventBus initialized at line 161 of application.cpp
- EventBus destroyed at line 1056 of application.cpp
- eventBus() accessor at line 62 of application.h
- Full test suite passes (387 tests)
- Full application compiles without errors

```bash
# Verification commands
grep -n "m_eventBus" src/app/application.h
# Output: 62, 103

grep -n "m_eventBus" src/app/application.cpp
# Output: 161, 1056

git log --oneline -1
# Output: 07b2a03 feat(1.1-02): add EventBus member to Application...

build/tests/dw_tests | tail -1
# Output: [  PASSED  ] 387 tests.
```

---
*Phase: 01.1-eventbus*
*Completed: 2026-02-09*
